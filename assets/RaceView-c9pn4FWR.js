import{d as $,r as I,u as ee,c as x,a as c,w as d,b as y,e as o,f as C,n as F,_ as te,g as se,o as u,T as ae,h as q,i as h,j as k,t as B,k as Y,l as re,F as R,m as O,p as z,q as j,R as H,s as oe,v as ne,x as ce,y as T,D as K}from"./index-er5vummF.js";const le={required:[e=>e&&e.trim()!==""?!0:"Campo requerido"]},ie=$({__name:"SearchControls",props:{restartBtnDisabled:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},emits:["searchImage","restart","clearSearch"],setup(e,{emit:r}){const s=I(""),t=r,a=ee(se).smaller("md"),p=m=>{m.preventDefault(),s.value.trim()&&t("searchImage",s.value)},v=()=>{s.value="",t("clearSearch")};return(m,f)=>{const w=c("v-text-field"),D=c("v-btn"),g=c("v-form");return u(),x(g,{"data-testid":"search"},{default:d(()=>[y("div",{class:F(["d-flex","ga-4",{"flex-column":C(a)}])},[o(w,{modelValue:s.value,"onUpdate:modelValue":f[0]||(f[0]=N=>s.value=N),variant:"outlined",label:"Buscar Imagen","bg-color":"#fff",rounded:"","prepend-inner-icon":"search",clearable:"","onClick:clear":v,rules:C(le).required,"hide-details":"","data-testid":"search__textfield"},null,8,["modelValue","rules"]),y("div",{class:F(["d-flex","ga-4","align-center",{"justify-space-between":C(a)}])},[o(D,{variant:"outlined",color:"primary",density:"default",icon:"replay",disabled:e.restartBtnDisabled,onClick:f[1]||(f[1]=N=>t("restart")),"data-testid":"search__restart-button"},null,8,["disabled"]),o(te,{type:"submit",onClick:p,text:"Buscar",disabled:e.isLoading,loading:e.isLoading,"data-testid":"search__search-button"},null,8,["disabled","loading"])],2)],2)]),_:1})}}}),ue={class:"d-flex flex-column w-100 px-2 mb-1"},de={class:"d-flex"},pe={class:"ml-1"},me={class:"d-flex justify-space-between w-100"},_e={class:"font-weight-thin"},ve=$({__name:"Progress",props:{competitorName:{type:String,default:""},score:{type:Number,default:0},goal:{type:Number,default:ae},color:{type:String,default:"#ccc"}},setup(e){const r=q(),s=e,t=h(()=>s.score*100/r.totalPoints),n=h(()=>{const a=r.totalPoints-s.score;return a<0?0:a});return(a,p)=>{const v=c("v-icon"),m=c("v-progress-linear");return u(),k("div",ue,[y("div",de,[o(v,{icon:"account_circle",color:e.color},null,8,["color"]),y("span",pe,B(e.competitorName),1)]),o(m,{color:e.color,height:"16","model-value":t.value,striped:""},{default:d(()=>[y("div",me,[y("span",null,B(e.score)+" pts",1),y("span",_e,"faltan "+B(n.value)+" pts",1)])]),_:1},8,["color","model-value"])])}}}),fe={class:"d-flex flex-column"},ge={class:"d-flex justify-end"},ye=$({__name:"Ranking",props:{preview:{type:Boolean,default:!1}},setup(e){const s=I(e.preview),t=q(),n=h(()=>t.score),a=h(()=>t.isLoading),p=h(()=>n!=null&&n.value.length&&s.value?n.value.slice(0,Y):n.value),v=m=>H[m]?H[m]:"secondary";return re(async()=>{t.initScore()}),(m,f)=>{const w=c("v-skeleton-loader"),D=c("v-btn");return u(),k("div",fe,[a.value?(u(),k(R,{key:0},O(3,g=>o(w,{type:"list-item",key:`loader-${g}`})),64)):(u(),k(R,{key:1},[(u(!0),k(R,null,O(p.value,(g,N)=>(u(),x(ve,{key:`seller-${g.sellerId}`,competitorName:g.sellerName,color:v(N),score:g.score},null,8,["competitorName","color","score"]))),128)),y("div",ge,[n.value.length>C(Y)?(u(),x(D,{key:0,class:"text-body-2 font-weight-thin px-1",density:"compact",variant:"text",onClick:f[0]||(f[0]=g=>s.value=!s.value)},{default:d(()=>[j(B(s.value?"ver mas...":"ver menos..."),1)]),_:1})):z("",!0)])],64))])}}}),he={class:"d-flex justify-space-between w-100 align-center"},be=$({__name:"ImageCard",props:{url:{type:String,default:""},sellerName:{type:String,default:""},sellerId:{type:String,default:""}},setup(e){const r=q(),s=e,t=()=>{r.setScore(s.sellerId)};return(n,a)=>{const p=c("v-img"),v=c("v-icon"),m=c("v-btn"),f=c("v-card-actions"),w=c("v-card");return u(),x(w,{flat:"",border:"sm"},{default:d(()=>[o(p,{color:"surface-variant",height:"300",src:e.url,cover:""},null,8,["src"]),o(f,null,{default:d(()=>[y("div",he,[y("span",null,[o(v,{icon:"account_circle"}),j(" "+B(e.sellerName),1)]),o(m,{flat:"",color:"pink",icon:"favorite_border",onClick:t})])]),_:1})]),_:1})}}}),Se=$({__name:"ImagesList",props:{items:{type:Array,default:()=>[]}},setup(e){return(r,s)=>{const t=c("v-col"),n=c("v-row");return u(),x(n,null,{default:d(()=>[(u(!0),k(R,null,O(e.items,a=>(u(),x(t,{cols:"12",sm:"6",md:"6",lg:"3",key:a.id},{default:d(()=>[o(be,{url:a.url,sellerName:a.sellerName,sellerId:a.sellerId},null,8,["url","sellerName","sellerId"])]),_:2},1024))),128))]),_:1})}}}),xe={};function we(e,r){const s=c("v-icon"),t=c("v-avatar"),n=c("v-banner-text"),a=c("v-banner");return u(),x(a,{color:"warning",border:"sm",rounded:"sm"},{prepend:d(()=>[o(t,{color:"warning"},{default:d(()=>[o(s,{icon:"info",color:"#fff"})]),_:1})]),default:d(()=>[o(n,null,{default:d(()=>r[0]||(r[0]=[j(" Al parecer no se han encontrado resultados para tu búsqueda, intenta una nueva búsqueda ")])),_:1})]),_:1})}const ke=oe(xe,[["render",we]]),Ne="OYtuv75YxYRArwCHSIrUD5oLjDKOvqE21xxAZipS9lLIHqAtp4auRyCD",Ie="https://api.pexels.com/v1",$e={search:async e=>{const{query:r,per_page:s}=e;try{const t=await fetch(`${Ie}/search?query=${r}&per_page=${s}`,{headers:{Authorization:Ne}}).then(a=>a.json());return"photos"in t?t.photos.map(({id:a,src:p})=>({id:a,url:p.original})):[]}catch(t){console.error(t)}}},De="/invoices",Le={create:async e=>{try{const r=await ne.post(De,e);return r.data?r.data:{}}catch{return console.log("error"),[]}}};var G=(e=>(e.cash="cash",e["debit-card"]="debit-card",e["credit-card"]="credit-card",e["service-card"]="service-card",e.transfer="transfer",e.check="check",e["electronic-wallet"]="electronic-wallet",e["electronic-money"]="electronic-money",e["grocery-voucher"]="grocery-voucher",e["dation-payment"]="dation-payment",e["subrogation-payment"]="subrogation-payment",e["allocation-payment"]="allocation-payment",e.forgiveness="forgiveness",e.compensation="compensation",e.novation="novation",e.misunderstanding="misunderstanding",e["debt-remission"]="debt-remission",e["prescription-or-expiration"]="prescription-or-expiration",e["creditor-satisfaction"]="creditor-satisfaction",e))(G||{});const Be={class:"view-layout"},Re=$({__name:"RaceView",setup(e){const r=ce(),s=q(),t=I([]),n=I(new Date().getTime()),a=I(!1),p=I(!1),v=h(()=>r.dialog),m=h(()=>s.score),f=h(()=>s.winner),w=h(()=>s.getFullScore()===0),D=h(()=>!!(p.value&&t.value.length===0&&!a.value)),g=async l=>{try{const b=m.value;a.value=!0,p.value=!0,t.value=[];const _=await $e.search({query:l,per_page:b.length});_!=null&&_.length&&(t.value=_.map((S,A)=>{const L=b[A];return{...S,sellerId:L.sellerId,sellerName:L.sellerName}}))}catch(b){console.error(b)}finally{a.value=!1}},N=()=>{r.activeDialog({...v.value,title:"Confirmación",message:"¿Estás seguro de que desea reiniciar la partida?, al confirmar perderás tu progreso",type:K.confirm,params:JSON.stringify({confirmed:!0})})},J=()=>{t.value=[],p.value=!1},U=async l=>{t.value=[],n.value=new Date().getTime(),r.activeDialog({...v.value,title:"¡Has votado!",message:`<div class="d-flex flex-column">
      Has ayudado a ${l.sellerName} a generar una factura con los puntos de todos los jugadores en esta partida.
      <span class="mt-2 text-success"> Puntos totales: ${s.getFullScore()} </span>
    </div>`,okButton:"Continuar",type:K.success,hasCloseButton:!1,isLoading:!1,params:JSON.stringify({confirmed:!0})})},Z=async l=>{var b;try{const _=new Date,S=_.getMonth()+1,A=S<9?`0${S}`:S.toString(),L=`${_.getFullYear()}-${A}-${_.getDate()}`,Q={paymentMethod:G["credit-card"],items:[{id:1,price:10,quantity:s.getFullScore()}],client:1,date:L,dueDate:L,seller:{id:l.sellerId}},V=await Le.create(Q),i=V?V.id:{};let E=null;return i.id&&(E={id:(i==null?void 0:i.id)||"",date:(i==null?void 0:i.date)||"",status:(i==null?void 0:i.status)||"",total:(i==null?void 0:i.number)||0,items:((b=i==null?void 0:i.items)==null?void 0:b.map(({id:X,name:P,price:W,quantity:M})=>({id:X,name:P,price:W,quantity:M})))||[]}),E}catch(_){return console.error(_),null}};return T(v,l=>{(l!=null&&l.data?JSON.parse(l.data):{}).confirmed&&(r.closeDialog(),n.value=new Date().getTime(),t.value=[],s.initScore(),p.value=!1)}),T(f,async l=>{l!=null&&l.sellerId&&(U(l),await Z(l))}),T(m,()=>{t.value.length&&(t.value=[],p.value=!1,n.value=new Date().getTime())}),(l,b)=>{const _=c("v-col"),S=c("v-row");return u(),k("div",Be,[o(S,{justify:"center","no-gutters":""},{default:d(()=>[o(_,{cols:"12",sm:"12",md:"12",lg:"10"},{default:d(()=>[(u(),x(ie,{key:n.value,restartBtnDisabled:w.value,isLoading:a.value,onSearchImage:g,onClearSearch:J,onRestart:N},null,8,["restartBtnDisabled","isLoading"]))]),_:1})]),_:1}),o(S,{justify:"center",class:"mt-4","no-gutters":""},{default:d(()=>[o(_,{cols:"12",sm:"12",md:"12",lg:"10"},{default:d(()=>[o(ye,{preview:""})]),_:1})]),_:1}),o(Se,{class:"mt-6",items:t.value},null,8,["items"]),D.value?(u(),x(S,{key:0,justify:"center",class:"mt-4","no-gutters":""},{default:d(()=>[o(ke)]),_:1})):z("",!0)])}}});export{Re as default};
